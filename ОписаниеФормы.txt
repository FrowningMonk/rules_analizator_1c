================================================================================
ИНСТРУКЦИЯ ПО СОЗДАНИЮ ВНЕШНЕЙ ОБРАБОТКИ
"Экспорт анализа прав доступа в Markdown"
================================================================================

1. СОЗДАНИЕ ВНЕШНЕЙ ОБРАБОТКИ
================================================================================

1.1 В конфигураторе: Файл -> Новый -> Внешняя обработка

1.2 Установить свойства обработки:
    - Имя: ЭкспортАнализаПравДоступаВMarkdown
    - Синоним: Экспорт анализа прав доступа в Markdown

1.3 Скопировать содержимое файла "МодульОбъекта_Обработки.bsl" в модуль объекта


2. СОЗДАНИЕ ФОРМЫ
================================================================================

2.1 Добавить форму:
    - Правый клик на "Формы" -> Добавить -> Форма
    - Тип формы: Форма обработки
    - Имя: Форма
    - Основная форма: Да


3. РЕКВИЗИТЫ ФОРМЫ
================================================================================

Добавить следующие реквизиты формы (Правый клик -> Добавить реквизит):

┌─────────────────────┬───────────────────────────────────────────┬─────────────┐
│ Имя реквизита       │ Тип                                       │ Заголовок   │
├─────────────────────┼───────────────────────────────────────────┼─────────────┤
│ ОбъектМетаданных    │ Строка (длина 430)                        │ Объект      │
│                     │                                           │ метаданных  │
├─────────────────────┼───────────────────────────────────────────┼─────────────┤
│ ИмяРоли             │ Строка (длина 255)                        │ Имя роли    │
├─────────────────────┼───────────────────────────────────────────┼─────────────┤
│ Профиль             │ СправочникСсылка.ПрофилиГруппДоступа      │ Профиль     │
├─────────────────────┼───────────────────────────────────────────┼─────────────┤
│ ТипДоступа          │ Строка (длина 100)                        │ Тип доступа │
├─────────────────────┼───────────────────────────────────────────┼─────────────┤
│ ПоказыватьПрофили   │ Булево                                    │ Показывать  │
│                     │                                           │ профили     │
├─────────────────────┼───────────────────────────────────────────┼─────────────┤
│ КоличествоСтрокРезультата  │ Число                                     │ Количество  │
│                     │                                           │ строк ТЗ    │
├─────────────────────┼───────────────────────────────────────────┼─────────────┤
│ ТаблицаРезультатов  │ ТаблицаЗначений (см. колонки ниже)        │ Результаты  │
├─────────────────────┼───────────────────────────────────────────┼─────────────┤
│ МодельИИ            │ Строка (длина 255)                        │ Модель ИИ   │
├─────────────────────┼───────────────────────────────────────────┼─────────────┤
│ СистемныйПромптИИ   │ Строка (неограниченная длина)             │ Системный   │
│                     │                                           │ промпт      │
├─────────────────────┼───────────────────────────────────────────┼─────────────┤
│ ОтветИИHTML         │ Строка (неограниченная длина)             │ Ответ ИИ    │
└─────────────────────┴───────────────────────────────────────────┴─────────────┘


4. КОЛОНКИ ТАБЛИЦЫ РЕЗУЛЬТАТОВ
================================================================================

Раскрыть реквизит "ТаблицаРезультатов" и добавить колонки:

┌──────────────────────┬───────────────────────────────────────────┬─────────────────────┐
│ Имя колонки          │ Тип                                       │ Заголовок           │
├──────────────────────┼───────────────────────────────────────────┼─────────────────────┤
│ ОбъектМетаданных     │ Строка (длина 430)                        │ Объект метаданных   │
├──────────────────────┼───────────────────────────────────────────┼─────────────────────┤
│ ИмяРоли              │ Строка (длина 255)                        │ Имя роли            │
├──────────────────────┼───────────────────────────────────────────┼─────────────────────┤
│ Профиль              │ СправочникСсылка.ПрофилиГруппДоступа      │ Профиль (ссылка)    │
├──────────────────────┼───────────────────────────────────────────┼─────────────────────┤
│ ТипДоступа           │ Строка (длина 100)                        │ Тип доступа         │
├──────────────────────┼───────────────────────────────────────────┼─────────────────────┤
│ ЕстьОграничение      │ Булево                                    │ RLS                 │
└──────────────────────┴───────────────────────────────────────────┴─────────────────────┘


5. КОМАНДЫ ФОРМЫ
================================================================================

Добавить команды формы (вкладка "Команды" -> Команды формы):

┌─────────────────────┬─────────────────────────────────┬─────────────────────────┐
│ Имя команды         │ Заголовок                       │ Действие                │
├─────────────────────┼─────────────────────────────────┼─────────────────────────┤
│ ПолучитьТЗ          │ Получить ТЗ                     │ ПолучитьТЗ              │
├─────────────────────┼─────────────────────────────────┼─────────────────────────┤
│ ВыгрузитьВMarkdown  │ Выгрузить в Markdown            │ ВыгрузитьВMarkdown      │
├─────────────────────┼─────────────────────────────────┼─────────────────────────┤
│ АналитикаПрав       │ Аналитика ИИ                    │ АналитикаПрав           │
└─────────────────────┴─────────────────────────────────┴─────────────────────────┘


6. СТРУКТУРА ЭЛЕМЕНТОВ ФОРМЫ
================================================================================

Создать следующую структуру элементов на форме:

Форма
│
├── СтраницыОсновные (Страницы)
│   │   Вид: Страницы
│   │   Отображение закладок: Сверху
│   │
│   ├── СтраницаОсновная (Страница)
│   │   │   Заголовок: Анализ прав
│   │   │
│   │   ├── ГруппаПараметры (ОбычнаяГруппа)
│   │   │   │   Вид: ОбычнаяГруппа
│   │   │   │   Отображение: ОбычноеВыделение
│   │   │   │   Группировка: ГоризонтальнаяЕслиВозможно
│   │   │   │   Заголовок: Параметры анализа
│   │   │   │
│   │   │   ├── ГруппаПараметрыЛевая (ОбычнаяГруппа)
│   │   │   │   │   Группировка: Вертикальная
│   │   │   │   │
│   │   │   │   ├── ОбъектМетаданных (ПолеВвода)
│   │   │   │   │       Путь к данным: ОбъектМетаданных
│   │   │   │   │       Кнопка выбора: Да
│   │   │   │   │       Событие НачалоВыбора: ОбъектМетаданныхНачалоВыбора
│   │   │   │   │       (открывает дерево выбора объектов метаданных)
│   │   │   │   │
│   │   │   │   ├── ИмяРоли (ПолеВвода)
│   │   │   │   │       Путь к данным: ИмяРоли
│   │   │   │   │       Кнопка выбора: Да
│   │   │   │   │       Событие НачалоВыбора: ИмяРолиНачалоВыбора
│   │   │   │   │       (открывает дерево выбора ролей конфигурации)
│   │   │   │   │
│   │   │   │   └── Профиль (ПолеВвода)
│   │   │   │           Путь к данным: Профиль
│   │   │   │           Кнопка выбора: Да
│   │   │   │
│   │   │   └── ГруппаПараметрыПравая (ОбычнаяГруппа)
│   │   │       │   Группировка: Вертикальная
│   │   │       │
│   │   │       ├── ТипДоступа (ПолеВвода)
│   │   │       │       Путь к данным: ТипДоступа
│   │   │       │       Режим выбора из списка: Да
│   │   │       │       Кнопка списка: Да
│   │   │       │
│   │   │       ├── КоличествоСтрокРезультата (ПолеВвода)
│   │   │       │       Путь к данным: КоличествоСтрокРезультата
│   │   │       │       ТолькоПросмотр: Да
│   │   │       │       Заголовок: Количество строк ТЗ
│   │   │       │
│   │   │       └── ПоказыватьПрофили (ПолеФлажка)
│   │   │               Путь к данным: ПоказыватьПрофили
│   │   │
│   │   ├── ГруппаКоманды (КоманднаяПанель)
│   │   │   │
│   │   │   ├── КнопкаПолучитьТЗ (Кнопка)
│   │   │   │       Имя команды: ПолучитьТЗ
│   │   │   │       Вид: ОбычнаяКнопка
│   │   │   │
│   │   │   ├── КнопкаВыгрузитьВMarkdown (Кнопка)
│   │   │   │       Имя команды: ВыгрузитьВMarkdown
│   │   │   │       Вид: ОбычнаяКнопка
│   │   │   │
│   │   │   └── КнопкаАналитикаПрав (Кнопка)
│   │   │           Имя команды: АналитикаПрав
│   │   │           Вид: ОбычнаяКнопка
│   │   │
│   │   └── ТаблицаРезультатов (ТаблицаФормы)
│   │           Путь к данным: ТаблицаРезультатов
│   │           Положение командной панели: Нет
│   │           Колонки:
│   │           - ОбъектМетаданных
│   │           - ИмяРоли
│   │           - Профиль
│   │           - ТипДоступа
│   │           - ЕстьОграничение (Заголовок: "RLS")
│   │
│   └── СтраницаНастройкиОтладки (Страница)
│       │   Заголовок: Настройки для отладки
│       │
│       ├── МодельИИ (ПолеВвода)
│       │       Путь к данным: МодельИИ
│       │       Заголовок: Модель ИИ
│       │
│       ├── СистемныйПромптИИ (ПолеВвода)
│       │       Путь к данным: СистемныйПромптИИ
│       │       Многострочный режим: Да
│       │       Высота: 10 строк
│       │       РастягиватьПоВертикали: Да
│       │       Заголовок: Системный промпт
│       │
│       └── ПолеОтветаИИ (ПолеHTML)
│               Путь к данным: ОтветИИHTML
│               Заголовок: Ответ ИИ
│               РастягиватьПоВертикали: Да
│               Высота: 15 строк


7. МОДУЛЬ ФОРМЫ
================================================================================

Скопировать содержимое файла "МодульФормы_Обработки.bsl" в модуль формы.


8. СОХРАНЕНИЕ
================================================================================

Сохранить обработку:
    Файл -> Сохранить как...
    Имя файла: ЭкспортАнализаПравДоступаВMarkdown.epf


================================================================================
ИСПОЛЬЗОВАНИЕ
================================================================================

1. Открыть обработку в 1С (Файл -> Открыть)

2. Заполнить один из параметров:
   - Объект метаданных: нажать [...] для выбора из дерева метаданных
     или ввести вручную, например "Справочник.Контрагенты"
   - Имя роли: нажать [...] для выбора из дерева ролей конфигурации
     или ввести вручную системное имя роли (например "МенеджерПродаж")
   - Профиль: выбрать из справочника ПрофилиГруппДоступа

3. Опционально:
   - Выбрать Тип доступа для фильтрации
   - Установить флаг "Показывать профили"

4. Нажать "Получить ТЗ" - таблица заполнится результатами

5. Нажать "Выгрузить в Markdown" - выбрать файл для сохранения

ВАЖНО: Выбор из дерева метаданных использует форму БСП
(СтандартныеПодсистемыКлиент.ВыбратьОбъектыМетаданных).
Если в базе нет БСП, кнопки выбора работать не будут -
используйте ручной ввод.


================================================================================
ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ
================================================================================

Пример 1: Узнать кто имеет доступ к справочнику Контрагенты
   - Объект метаданных: Справочник.Контрагенты
   - Показывать профили: Да

Пример 2: Узнать к чему имеет доступ роль ПолныеПрава
   - Имя роли: ПолныеПрава

Пример 3: Узнать объекты с правом Изменение для профиля
   - Профиль: (выбрать профиль)
   - Тип доступа: Изменение
