# Работа с Git для проекта 1С: Анализ прав доступа

Пошаговая инструкция по работе с Git в проекте внешней обработки 1С.

## Общая схема работы

1.  Создать ветку
2.  Внести изменения в BSL/TXT
3.  Обновить EPF
4.  Выгрузить в файлы
5.  Закоммитить
6.  Отправить на GitHub
7.  Создать PR
8.  Смержить
9.  Обновить локальный main

## Шаг 1: Создание новой ветки

```bash
git checkout -b название-ветки
```

**Пример:**

```bash
git checkout -b fix-form-validation
```

**Правила именования:**

*   Латиница, дефисы
*   По смыслу изменений: `fix-form-bug`, `add-export-feature`, `update-docs`

## Шаг 2: Внесение изменений в исходники

*   Редактируйте `.bsl` файлы (код)
*   При необходимости редактируйте `ОписаниеФормы.txt`
*   Проверяйте статус:

```bash
git status
```

## Шаг 3: Обновление EPF файла

*   Откройте `ПродвинутыйАнализПрав.epf` в конфигураторе 1С
*   Скопируйте изменения из `.bsl` файлов в соответствующие модули EPF
*   Сохраните и закройте EPF

## Шаг 4: Выгрузка изменений в файлы

*   В конфигураторе 1С откройте `ПродвинутыйАнализПрав.epf`
*   Выполните: "Действия"  → "Выгрузить в файлы"
*   Укажите папку проекта (перезапись существующих файлов)
*   Это обновит `.xml`, `.bsl` и другие файлы в папке `ПродвинутыйАнализПрав/`

## Шаг 5: Добавление файлов в индекс

```bash
# Добавить все изменения
git add .

# Или конкретные файлы
git add ПродвинутыйАнализПрав.epf
git add "ПродвинутыйАнализПрав/Ext/ObjectModule.bsl"
```

## Шаг 6: Создание коммита

```bash
git commit -m "Описание изменений"
```

**Примеры сообщений:**

*   "Исправил валидацию формы анализа"
*   "Добавил экспорт результатов в HTML"
*   "Обновил документацию по восстановлению"

## Шаг 7: Отправка ветки на GitHub

```bash
git push origin название-ветки
```

**Пример:**

```bash
git push origin fix-form-validation
```

При первой отправке выполните предложенную Git команду с `--set-upstream`.

## Шаг 8: Промежуточное сохранение незавершенной работы

### Вариант А: WIP коммит (рекомендуется)

```bash
git add .
git commit -m "WIP: начал работу над валидацией"
```

На следующий день:

```bash
# Продолжите работу, затем финальный коммит
git add .
git commit -m "Завершил реализацию валидации формы"
git push origin текущая-ветка
```

### Вариант Б: Git Stash (для экспериментов)

```bash
git stash save "эксперимент с новой логикой"
```

Восстановление:

```bash
git stash pop
```

## Шаг 9: Создание Pull Request на GitHub

*   Откройте репозиторий на GitHub
*   Найдите свою ветку и нажмите "Compare & pull request"
*   Заполните описание (если нужно)
*   Нажмите "Create pull request"

## Шаг 10: Слияние в основную ветку

### Через GitHub (рекомендуется):

*   В Pull Request нажмите "Merge pull request"
*   Подтвердите "Confirm merge"
*   При желании удалите ветку кнопкой "Delete branch"

### Локально:

```bash
git checkout main
git merge название-ветки
git push origin main
```

## Шаг 11: Обновление локального main

После слияния на GitHub:

```bash
git checkout main
git pull origin main
```

## Полный пример рабочего цикла

```bash
# 1. Убедитесь, что main актуален
git checkout main
git pull origin main

# 2. Создайте ветку для задачи
git checkout -b fix-export-bug

# 3. Редактируйте .bsl файлы
# 4. Обновите код в .epf через конфигуратор
# 5. Выгрузите изменения в файлы через конфигуратор

# 6. Добавьте изменения в Git
git add .

# 7. Создайте коммит
git commit -m "Исправил баг с экспортом в Markdown"

# 8. Отправьте на GitHub
git push origin fix-export-bug

# 9. Создайте PR на GitHub и смержьте

# 10. Обновите локальный main
git checkout main
git pull origin main
```

## Полезные команды

| Команда                       | Описание                                  |
| :---------------------------- | :---------------------------------------- |
| `git status`                  | Показать состояние файлов                 |
| `git branch`                  | Показать список веток                     |
| `git log --oneline`           | Краткая история коммитов                  |
| `git diff`                    | Показать изменения в файлах               |
| `git checkout main`           | Переключиться на ветку main              |
| `git branch -d ветка`         | Удалить локальную ветку                   |
| `git stash save "описание"`   | Сохранить незавершённые изменения         |
| `git stash pop`               | Восстановить последние сохранённые изменения |

## Особенности проекта 1С

**Важно помнить:**

*   Всегда синхронизируйте `.bsl` файлы и `.epf`
*   После изменений в `.epf` обязательно выгружайте в файлы
*   `.epf` - бинарный файл, Git не может показать diff для него
*   При конфликтах в `.epf` придётся выбирать одну версию целиком

### Разрешение конфликтов в .epf:

```bash
# Выбрать свою версию
git checkout --ours ПродвинутыйАнализПрав.epf

# Или чужую версию
git checkout --theirs ПродвинутыйАнализПрав.epf

# Затем пересоздать .epf из актуальных исходников
```

## Частые ошибки

### Забыли выгрузить изменения в файлы

**Решение:** Выгрузите `.epf` в файлы, затем добавьте изменения в Git.

### Конфликт в бинарных файлах (.epf, .xml)

**Решение:** Выберите одну версию, затем пересоберите файлы из исходников.

### Изменения в .epf не соответствуют .bsl

**Решение:** Проверьте, что скопировали все изменения из `.bsl` в `.epf` перед выгрузкой.